---
layout: default
---

.page
  .header
    %h1 Animal, Vegetable, or Mineral?
    %p wherein prototypal inheritance models the universe in JavaScript

.page
  %h3 First, a root object:
  %pre
    :preserve
      thing = {
        location: 'the universe',
        organic: false,
        motile: false
      };
.page
  .header
    %h3 Then, to inherit from thing.
    %p The old-fashioned way takes 3 lines:
  %pre
    :preserve
      ConstructThing = function() {};
      ConstructThing.prototype = thing;
      mineral = new ConstructThing();
  %pre
    :preserve
      mineral.location;
.page
  %h3 We could have the constructor do something:
  %pre
    :preserve
      ConstructThing = function() {
        this.createdAt = new Date;
      };
      ConstructThing.prototype = thing;
      mineral = new ConstructThing();
.page
  %h3 Moving along to the rest of the universe
  %pre
    :preserve
      ConstructMineral = function(){};
      ConstructMineral.prototype = mineral;
  %pre
    :preserve
      organism = new ConstructThing();
      organism.organic = true;

      ConstructOrganism = function(){};
      ConstructOrganism.prototype = organism;
.page
  %pre
    :preserve
      vegetable = new ConstructOrganism;
      ConstructVegetable = function(){};
      ConstructVegetable.prototype = vegetable;
.page
  %pre
    :preserve
      animal = new ConstructOrganism;
      animal.motile = true;
  %pre
    :preserve
      ConstructAnimal = function(){};
      ConstructAnimal.prototype = animal;
.page
  %pre
    :preserve
      caveMan = new ConstructAnimal;
      club = new ConstructVegetable;
      rock = new ConstructMineral;
  %pre
    :preserve
      [caveMan, club, rock].map(function(o) { return o.location });
  %pre
    :preserve
      [caveMan, club, rock].map(function(o) { return o.organic });
  %pre
    :preserve
      [caveMan, club, rock].map(function(o) { return o.motile });
.page
  %h3
    Problems with this approach:
  %ol
    %li It's rather awkward. (verbose, and conflicted)
    %li
      The danger of forgetting "new":
      %pre
        :preserve
          OtherWindow = function(location) {
            this.location = location;
          }
          anotherWindow = new OtherWindow(); // fine
          anotherWindow = OtherWindow();     // doh!
    %li
      Constructors are not inheritable:
      %pre
        :preserve
          [caveMan, club, rock].map(function(o) { return o.createdAt });
.page
  .header
    %h3 Could there be a less awkward way to inherit?
    %p One great answer: ECMAScript5 gives us:
  %pre
    :preserve
      something = Object.create(thing);
  %p
    We can easily backport this (see http://javascript.crockford.com/prototypal.html):
  %pre
    :preserve
      Object.create = function (proto) {
        function Constructor() {}
        Constructor.prototype = proto;
        return new Constructor();
      };
.page
  %h2 Let's set up that taxonomy up again.
  %pre
    :preserve
      thing = {
        location: 'the universe',
        organic: false,
        motile: false
      };
  %pre
    :preserve
      mineral = Object.create(thing);

      organism = Object.create(thing);
      organism.organic = true;

      vegetable = Object.create(organism);

      animal = Object.create(organism);
      animal.motile = true;
.page
  %pre
    :preserve
      caveMan = Object.create(animal);
      club = Object.create(vegetable);
      rock = Object.create(mineral);
  %pre
    :preserve
      [caveMan, club, rock].map(function(o) { return o.location });
      [caveMan, club, rock].map(function(o) { return o.organic });
      [caveMan, club, rock].map(function(o) { return o.motile });
.page
  %h2 What about constructors?
  %p
    A simple proposal (inspired by
    %a{:href => 'http://javascript.crockford.com/prototypal.html'}<
      Crockford
    ):
  %pre
    :preserve
      thing.initialize = function() {
        this.createdAt = new Date;
      }
  %pre
    :preserve
      thing.beget = function(properties) {
        var begotten = Object.create(this);
        begotten.initialize;
        return begotten;
      }
  %pre
    :preserve
      mineral = thing.beget();
      mineral.location;
.page
  %h2 A step further:
  %p Target: provide for initializing properties with
  %pre
    :preserve
      // something = thing.beget({prop: 'value', ...});
.page
  %pre
    :preserve
      thing.beget = function(properties) {
        var begotten = Object.create(this);
        begotten.initialize;
        for (key in properties) {
          if (properties.hasOwnProperty(key)) {
            begotten[key] = properties[key];
          }
        }
        return begotten;
      };
.page
  %pre
    :preserve
      mineral = thing.beget();
      organism = thing.beget({organic: true});
      vegetable = organism.beget();
      animal = organism.beget({motile: true});
.page
  %pre
    :preserve
      caveMan = animal.beget();
      club = vegetable.beget();
      rock = mineral.beget();
  %pre
    :preserve
      [caveMan, club, rock].map(function(o) { return o.location });
  %pre
    :preserve
      [caveMan, club, rock].map(function(o) { return o.organic });
  %pre
    :preserve
      [caveMan, club, rock].map(function(o) { return o.motile });
  %pre
    :preserve
      [caveMan, club, rock].map(function(o) { return o.createdAt });

.page
  %h2 Recommended Reading
  :markdown
    - See the [Source code](/javascripts/slide_show.js) to this slide deck for a less contrived example.
    - [Understanding “Prototypes” in JavaScript](http://yehudakatz.com/2011/08/12/understanding-prototypes-in-javascript/), Yehuda Katz
    - [Simple JavaScript Inheritance](http://ejohn.org/blog/simple-javascript-inheritance/), John Resig
    - [Constructors considered mildly confusing](http://joost.zeekat.nl/constructors-considered-mildly-confusing.html) by Joost Diepenmaat, Zeekat Softwareontwikkeling
    - [Prototypal Inheritance in JavaScript](http://javascript.crockford.com/prototypal.html), Douglas Crockford
    - [Inheritance and the prototype chain](https://developer.mozilla.org/en-US/docs/JavaScript/Guide/Inheritance_and_the_prototype_chain), MDN
